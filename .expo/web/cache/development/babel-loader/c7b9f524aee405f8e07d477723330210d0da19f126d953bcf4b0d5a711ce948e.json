{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useEffect, useState } from \"react\";\nimport { createSession } from \"../services/api\";\nimport { api } from \"../services/api\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport var AuthContext = createContext();\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState({}),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  useEffect(function () {\n    var loadData = function () {\n      var _ref2 = _asyncToGenerator(function* () {\n        var user = yield AsyncStorage.getItem('user');\n        var token = yield AsyncStorage.getItem('token');\n        if (user && token) {\n          setUser(JSON.parse(user));\n          api.defaults.headers.Authorization = `Bearer ${token}`;\n        }\n      });\n      return function loadData() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    loadData();\n  }, []);\n  var login = function () {\n    var _ref3 = _asyncToGenerator(function* (data) {\n      var response = yield createSession(data.username, data.senha);\n      yield AsyncStorage.setItem('user', JSON.stringify(response.data.user));\n      yield AsyncStorage.setItem('token', response.data.token);\n      api.defaults.headers.Authorization = `Bearer ${response.data.token}`;\n      setUser(response.data.user);\n    });\n    return function login(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var logout = function () {\n    var _ref4 = _asyncToGenerator(function* () {\n      yield AsyncStorage.removeItem('user');\n      yield AsyncStorage.removeItem('token');\n      api.defaults.headers.Authorization = null;\n      setUser(null);\n    });\n    return function logout() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  return _jsx(AuthContext.Provider, {\n    value: {\n      authenticated: user ? true : false,\n      user: user,\n      login: login,\n      logout: logout,\n      loading: loading\n    },\n    children: children\n  });\n};","map":{"version":3,"names":["React","createContext","useEffect","useState","createSession","api","AsyncStorage","jsx","_jsx","AuthContext","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","loading","setLoading","loadData","_ref2","_asyncToGenerator","getItem","token","JSON","parse","defaults","headers","Authorization","apply","arguments","login","_ref3","data","response","username","senha","setItem","stringify","_x","logout","_ref4","removeItem","Provider","value","authenticated"],"sources":["C:/Users/victo/Desktop/rotas-tcc/context/auth.jsx"],"sourcesContent":["import React, { createContext, useEffect, useState } from \"react\";\r\n\r\nimport { createSession } from \"../services/api\";\r\nimport { api } from \"../services/api\";\r\n\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nexport const AuthContext = createContext()\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n\r\n    const [user, setUser] = useState({})\r\n    \r\n    const [loading, setLoading] = useState(false)\r\n\r\n    useEffect(() =>{\r\n        const loadData = async () => {\r\n            const user = await AsyncStorage.getItem('user')\r\n            const token = await AsyncStorage.getItem('token')\r\n\r\n            // console.log(user, token)\r\n            if(user && token){\r\n                setUser(JSON.parse(user))\r\n                api.defaults.headers.Authorization = `Bearer ${token}`\r\n            }\r\n        }\r\n\r\n        loadData()\r\n\r\n    }, [])\r\n\r\n    const login = async (data) => {\r\n        const response = await createSession(data.username, data.senha)\r\n        await AsyncStorage.setItem('user', JSON.stringify(response.data.user))\r\n        await AsyncStorage.setItem('token', response.data.token)\r\n\r\n        api.defaults.headers.Authorization = `Bearer ${response.data.token}`\r\n        setUser(response.data.user)\r\n    }\r\n\r\n    const logout = async () => {\r\n        await AsyncStorage.removeItem('user')\r\n        await AsyncStorage.removeItem('token')\r\n\r\n        api.defaults.headers.Authorization = null\r\n\r\n        setUser(null)\r\n    }\r\n\r\n    return(\r\n        <AuthContext.Provider value={{authenticated: (user ? true : false), user, login, logout, loading}}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    )\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}